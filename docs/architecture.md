# Архитектура проекта

## Функциональный подход

Проект использует **функциональный подход без классов**. Все компоненты реализованы как именованные функции и модули.

## Слоистая архитектура

Проект организован в следующие слои:

```
┌─────────────────────────────────────┐
│   Netlify Functions (Entry Point)   │
│   - telegram-webhook.ts             │
│   - youth-poll-scheduler.ts          │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Handlers (Message Routing)        │
│   - messageHandler.ts               │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Commands (Business Logic)         │
│   - createPollCommand.ts             │
│   - prayerRequestCommand.ts          │
│   - ... (11 команд)                  │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Services (External APIs)          │
│   - telegramService.ts               │
│   - notionService.ts                 │
│   - calendarService.ts               │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Utils (Helpers)                   │
│   - logger.ts                        │
│   - authHelper.ts                    │
│   - dateHelper.ts                    │
│   - ... (8 утилит)                   │
└──────────────┬──────────────────────┘
               │
┌──────────────▼──────────────────────┐
│   Config (Configuration)            │
│   - environment.ts                  │
└─────────────────────────────────────┘
```

## Принципы архитектуры

1. **Разделение ответственности**: каждый слой имеет четкую ответственность
2. **Именованные экспорты**: все функции экспортируются именованно (не default)
3. **Singleton для клиентов**: Telegram и Notion клиенты создаются один раз
4. **Единый формат ответа**: все команды возвращают `CommandResult`
5. **Централизованное логирование**: все логи через единую систему

## Поток данных

1. **Входящий запрос**: Telegram отправляет webhook на Netlify Function
2. **Обработка**: Handler маршрутизирует сообщение к соответствующей команде
3. **Бизнес-логика**: Command выполняет необходимые операции
4. **Сервисы**: Используются сервисы для работы с внешними API
5. **Утилиты**: Вспомогательные функции для форматирования и обработки
6. **Ответ**: Результат возвращается через Telegram Service

## Модульность

Каждый компонент изолирован и может быть легко протестирован или заменен:

- **Commands** - независимые модули обработки команд
- **Services** - абстракции над внешними API
- **Utils** - переиспользуемые утилиты
- **Config** - централизованная конфигурация

---

[← Назад к содержанию](README.md) | [Далее: Структура файлов →](file-structure.md)

